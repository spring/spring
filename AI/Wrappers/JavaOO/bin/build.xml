<?xml version="1.0"?>

<!--
	Do not edit this file!
	But edit ant.properties instead.

	@author: Robin Vobruba <hoijui.quaero@gmail.com>
-->
<project name="JavaOO" basedir="../" default="pack">
	<!--
		This file does:
			* generate-src:  generate java sources
			* compile:       compile java sources
			* doc:           generate javadoc
			* pack:          pack java classes and sources into jar files
			* dist:          install these two jar files
			* sdk:           create the OO Java AI SDK in a dir specified through a parameter
	-->

	<property name="wrapper.name" value="${ant.project.name}"/>


	<target name="init">

		<property file="bin/ant.properties"/>
		<!--
			The following values may be overriden in either
			"bin/ant.properties" or any other properties file
			which may be specified to ant on the command line like this:
			ant -propertyfile someFile.properties
		-->
		<property name="spring.home"            location="../../.."/>
		<property name="awk.common.scripts.dir" location="${spring.home}/AI/Wrappers/CUtils/bin"/>
		<property name="build.home"             location="${spring.home}/build"/>
		<property name="build.dir"              location="${build.home}/AI/Wrappers/${wrapper.name}"/>
		<property name="classes.dir"            location="${build.dir}/classes"/>
		<property name="dist.home"              location="${spring.home}/dist"/>
		<property name="dist.dir"               location="${dist.home}/AI/Wrappers/${wrapper.name}"/>
		<property name="doc.dir"                location="${dist.home}/AI/Wrappers/${wrapper.name}/doc/jdoc"/>
		<property name="src.generated"          location="${build.dir}/src-generated/main"/>
		<property name="src.generated.java"     location="${src.generated}/java"/>

		<property name="jar.file.name"     value="AIWrapper"/>
		<property name="jar.file.name.bin" value="${jar.file.name}.jar"/>
		<property name="jar.file.name.src" value="${jar.file.name}-src.jar"/>
		<property name="java.pkg.dir"      value="com/springrts/ai"/>
		<property name="java.pkg.oo.dir"   value="${java.pkg.dir}/oo"/>

		<property name="spring.ai.interface.src.home"           location="${spring.home}/AI/Interfaces/Java"/>
		<property name="spring.ai.interface.src.dir"            location="${spring.ai.interface.src.home}/src/main/java"/>
		<property name="spring.ai.interface.build.home"         location="${build.home}/AI/Interfaces/Java"/>
		<property name="spring.ai.interface.src.generated.dir"  location="${spring.ai.interface.build.home}/src-generated/main/java"/>
		<property name="src.java"                               location="src/main/java"/>
		<property name="bin.dir"                                location="bin"/>
		<path id="source.path.id">
			<pathelement path="${src.java}"/>
			<pathelement path="${src.generated.java}"/>
		</path>
		<path id="class.path.id">
			<pathelement path="${spring.ai.interface.build.home}/classes"/>
			<fileset dir="jlib">
				<include name="**/*.jar"/>
			</fileset>
		</path>

		<mkdir dir="${build.dir}"/>
		<mkdir dir="${classes.dir}"/>

		<condition property="awk.bin" value="awk.exe" else="awk">
			<os family="windows" />
		</condition>
	</target>



	<target name="generate-init" depends="init">
		<mkdir dir="${src.generated}"/>
		<mkdir dir="${src.generated.java}/${java.pkg.oo.dir}"/>
	</target>


	<target name="generate-src-callback" depends="generate-init">

		<delete dir="${src.generated.java}/${java.pkg.oo.dir}/clb"/>
		<mkdir  dir="${src.generated.java}/${java.pkg.oo.dir}/clb"/>

		<exec dir="${bin.dir}" executable="${awk.bin}"
				failonerror="true" resolveexecutable="true" searchpath="true">
			<arg value="-v"/><arg value="INTERFACE_SOURCE_DIR=${spring.ai.interface.src.dir}"/>
			<arg value="-v"/><arg value="INTERFACE_GENERATED_SOURCE_DIR=${spring.ai.interface.src.generated.dir}"/>
			<arg value="-v"/><arg value="JAVA_GENERATED_SOURCE_DIR=${src.generated.java}"/>

			<arg value="-f"/><arg value="${awk.common.scripts.dir}/common.awk"/>
			<arg value="-f"/><arg value="${awk.common.scripts.dir}/commonDoc.awk"/>
			<arg value="-f"/><arg value="${awk.common.scripts.dir}/commonOOCallback.awk"/>
			<arg value="-f"/><arg value="wrappCallback.awk"/>

			<arg value="${spring.ai.interface.src.generated.dir}/${java.pkg.dir}/AICallback.java"/>
		</exec>
	</target>


	<target name="generate-src-events" depends="generate-init">

		<delete dir="${src.generated.java}/${java.pkg.oo.dir}/evt"/>
		<mkdir  dir="${src.generated.java}/${java.pkg.oo.dir}/evt"/>

		<exec dir="${bin.dir}" executable="${awk.bin}"
				failonerror="true" resolveexecutable="true" searchpath="true">
			<arg value="-v"/><arg value="INTERFACE_SOURCE_DIR=${spring.ai.interface.src.dir}"/>
			<arg value="-v"/><arg value="INTERFACE_GENERATED_SOURCE_DIR=${spring.ai.interface.src.generated.dir}"/>
			<arg value="-v"/><arg value="JAVA_GENERATED_SOURCE_DIR=${src.generated.java}"/>

			<arg value="-f"/><arg value="${awk.common.scripts.dir}/common.awk"/>
			<arg value="-f"/><arg value="${awk.common.scripts.dir}/commonDoc.awk"/>
			<arg value="-f"/><arg value="wrappEvents.awk"/>

			<arg value="${spring.ai.interface.src.generated.dir}/${java.pkg.dir}/AI.java"/>
		</exec>
	</target>


	<target name="generate-src"
			depends="generate-src-events, generate-src-callback"/>


	<target name="compile" depends="generate-src">
		<javac destdir="${classes.dir}">
			<src refid="source.path.id"/>
			<classpath refid="class.path.id"/>
		</javac>
	</target>


	<target name="doc" depends="generate-src">
		<mkdir dir="${doc.dir}"/>
		<javadoc
				destdir="${doc.dir}"
				sourcepathref="source.path.id"
				classpathref="class.path.id"
				Windowtitle="Sprint RTS Java OO AI Wrapper javadoc"/>
	</target>


	<target name="pack-bin" depends="compile">
		<jar destfile="${build.dir}/${jar.file.name.bin}">
			<fileset dir="${classes.dir}">
				<include name="**/*.class"/>
			</fileset>
		</jar>
	</target>

	<target name="pack-src" depends="init">
		<jar destfile="${build.dir}/${jar.file.name.src}">
			<fileset dir="${src.java}">
				<include name="**/*.java"/>
			</fileset>
			<fileset dir="${src.generated.java}">
				<include name="**/*.java"/>
			</fileset>
		</jar>
	</target>

	<target name="pack" depends="pack-bin, pack-src"/>


	<target name="dist" depends="pack"
				description="generate the distribution (Java part only)" >
		<mkdir dir="${dist.dir}/jlib"/>
		<copy file="${build.dir}/${jar.file.name.bin}" todir="${dist.dir}" overwrite="true"/>
		<copy file="${build.dir}/${jar.file.name.src}" todir="${dist.dir}/jlib" overwrite="true"/>
	</target>

	<target name="clean" depends="init">
		<delete dir="${src.generated.java}"/>
		<delete dir="${src.generated}"/>
		<delete dir="${classes.dir}"/>
		<delete dir="${build.dir}"/>
	</target>


	<target name="sdk-init">
		<fail message="No valid SDK root set. Please specify like this: -Dsdk.home=/tmp/mySpringJavaAISDK">
			<condition>
				<not>
					<isset property="sdk.home"/>
				</not>
			</condition>
		</fail>

		<property name="build.home" location="${sdk.home}/build"/>
		<property name="build.dir"  location="${build.home}"/>
		<property name="dist.home"  location="${sdk.home}"/>
		<property name="dist.dir"   location="${dist.home}"/>
		<property name="doc.dir"    location="${dist.home}/doc/jdoc"/>
		<property name="src.generated"        location="${build.dir}/src-generated/main"/>
		<property name="src.generated.java"   location="${src.generated}/java"/>
	</target>

	<target name="sdk" depends="sdk-init, init, dist, doc">
		<delete dir="${build.dir}" quiet="true"/>
	</target>

</project>
