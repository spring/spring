### C & C++ AI Interface
#
# BUILD_C_AIINTERFACE is set in this file (PARENT_SCOPE),
# and used in ../../Skirmish/*/CMakeLists.txt
#

if ("${AIINTERFACES}" STREQUAL "ALL" OR "${AIINTERFACES}" STREQUAL "NATIVE")
	set(AIINTERFACES_NATIVE "TRUE")
endif ("${AIINTERFACES}" STREQUAL "ALL" OR "${AIINTERFACES}" STREQUAL "NATIVE")

#set(C_AIINTERFACE_SRC "${AI_INTERFACES_SRC}/C")
set(C_AIINTERFACE_SRC "${CMAKE_CURRENT_SOURCE_DIR}")

if (EXISTS ${C_AIINTERFACE_SRC} AND AIINTERFACES_NATIVE)
	set(BUILD_C_AIINTERFACE TRUE)
else (EXISTS ${C_AIINTERFACE_SRC} AND AIINTERFACES_NATIVE)
	set(BUILD_C_AIINTERFACE FALSE)
	message ("warning: C & C++ AI Interface will not be built!")
endif (EXISTS ${C_AIINTERFACE_SRC} AND AIINTERFACES_NATIVE)
set(BUILD_C_AIINTERFACE ${BUILD_C_AIINTERFACE} PARENT_SCOPE)

if (BUILD_C_AIINTERFACE)
	set(C_AIINTERFACE_VERS "UNKNOWN_VERSION")
	if (EXISTS ${C_AIINTERFACE_SRC}/VERSION)
		file(STRINGS "${C_AIINTERFACE_SRC}/VERSION" C_AIINTERFACE_VERS LIMIT_COUNT 1)
	endif (EXISTS ${C_AIINTERFACE_SRC}/VERSION)
	# The target has to be set in ../../Skirmish/CMakeLists.txt, aswell,
	# as compilation fails otherwise with multiple threads,
	# using PARENT_SCOPE seems not to work.
	set(C_AIINTERFACE_TARGET "C-AI-Interface")
	#set(C_AIINTERFACE_TARGET ${C_AIINTERFACE_TARGET} PARENT_SCOPE)
	set(C_AIINTERFACE_DATA_DIR ${AI_INTERFACES_DATA}/C/${C_AIINTERFACE_VERS})
	if (NOT AIINTERFACE_FIND_QUIETLY)
		message(STATUS "Found: ${C_AIINTERFACE_TARGET} ${C_AIINTERFACE_VERS}")
	endif (NOT AIINTERFACE_FIND_QUIETLY)

	# install data files
	install(DIRECTORY "${C_AIINTERFACE_SRC}/data/"
			DESTINATION "${C_AIINTERFACE_DATA_DIR}")

	aux_source_directory(${C_AIINTERFACE_SRC} cAIInterface)
	list (APPEND cAIInterface ${CMAKE_SOURCE_DIR}/rts/System/Platform/SharedLib)
	if (UNIX)
		list (APPEND cAIInterface ${CMAKE_SOURCE_DIR}/rts/System/Platform/Linux/SoLib)
	else (UNIX)
		list (APPEND cAIInterface ${CMAKE_SOURCE_DIR}/rts/System/Platform/Win/DllLib)
	endif (UNIX)
	add_library(${C_AIINTERFACE_TARGET} MODULE ${cAIInterface} ${ai_common} ${cutilsenv})
	set_target_properties(${C_AIINTERFACE_TARGET} PROPERTIES OUTPUT_NAME "AIInterface")
	#set_target_properties(${C_AIINTERFACE_TARGET} PROPERTIES LIBRARY_OUTPUT_DIRECTORY "C")
	install(TARGETS ${C_AIINTERFACE_TARGET} DESTINATION ${C_AIINTERFACE_DATA_DIR})
endif (BUILD_C_AIINTERFACE)
set(BUILD_C_AIINTERFACE ${BUILD_C_AIINTERFACE} PARENT_SCOPE)

